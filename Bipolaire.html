<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>üîÑ MindFlow - Cycles</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#8B7EB8">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    :root {
      --primary: #8B7EB8;
      --primary-light: #B8A7D5;
      --secondary: #A8D8EA;
      --text-dark: #2D2D3A;
      --text-gray: #666;
      --text-light: #888;
      --bg-card: rgba(139, 126, 184, 0.05);
      --shadow-sm: 0 4px 20px rgba(0,0,0,0.08);
      --shadow-md: 0 8px 30px rgba(0,0,0,0.12);
      --radius-sm: 12px;
      --radius-md: 20px;
      --radius-lg: 25px;
      --transition: all 0.3s ease;
      
      --manie: #f59e0b;
      --hypomanie: #fbbf24;
      --stable: #10b981;
      --depression: #3b82f6;
      --mixte: #8b5cf6;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      min-height: 100vh;
      padding: 15px;
      padding-bottom: 100px;
    }
    
    .container {
      max-width: 450px;
      margin: 0 auto;
      width: 100%;
      padding: 0 5px;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 25px;
      background: white;
      border-radius: var(--radius-md);
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
    }
    
    .back-btn {
      font-size: 24px;
      cursor: pointer;
      text-decoration: none;
      transition: var(--transition);
    }
    
    .header-title {
      font-size: 20px;
      font-weight: bold;
      color: var(--primary);
    }
    
    .header-placeholder { width: 24px; }
    
    .card {
      background: white;
      border-radius: var(--radius-lg);
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
    }
    
    .card-title {
      font-size: 20px;
      font-weight: bold;
      color: var(--text-dark);
      margin-bottom: 20px;
    }
    
    .phase-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .phase-btn {
      padding: 15px;
      border: 3px solid transparent;
      border-radius: var(--radius-sm);
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      transition: var(--transition);
      color: white;
    }
    
    .phase-btn.manie {
      background: var(--manie);
    }
    
    .phase-btn.hypomanie {
      background: var(--hypomanie);
    }
    
    .phase-btn.stable {
      background: var(--stable);
    }
    
    .phase-btn.depression {
      background: var(--depression);
    }
    
    .phase-btn.mixte {
      background: var(--mixte);
    }
    
    .phase-btn.selected {
      border-color: var(--text-dark);
      transform: scale(1.05);
    }
    
    .phase-btn:active {
      transform: scale(0.95);
    }
    
    .intensity-group {
      margin-bottom: 20px;
    }
    
    .intensity-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-gray);
      margin-bottom: 10px;
    }
    
    .intensity-slider {
      width: 100%;
      height: 8px;
      -webkit-appearance: none;
      appearance: none;
      background: #E5E5E5;
      border-radius: 5px;
      outline: none;
      margin-bottom: 8px;
    }
    
    .intensity-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      background: var(--primary);
      border-radius: 50%;
      cursor: pointer;
    }
    
    .intensity-value {
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      color: var(--primary);
    }
    
    .note-textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #E5E5E5;
      border-radius: var(--radius-sm);
      font-size: 15px;
      font-family: inherit;
      resize: vertical;
      min-height: 80px;
      outline: none;
      margin-bottom: 15px;
    }
    
    .note-textarea:focus {
      border-color: var(--primary);
    }
    
    .save-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      border: none;
      border-radius: 15px;
      font-size: 17px;
      font-weight: bold;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .save-btn:active {
      transform: scale(0.98);
    }
    
    .history-list {
      list-style: none;
    }
    
    .history-item {
      background: var(--bg-card);
      padding: 15px;
      border-radius: var(--radius-sm);
      margin-bottom: 10px;
      border-left: 4px solid;
    }
    
    .history-item.manie {
      border-left-color: var(--manie);
    }
    
    .history-item.hypomanie {
      border-left-color: var(--hypomanie);
    }
    
    .history-item.stable {
      border-left-color: var(--stable);
    }
    
    .history-item.depression {
      border-left-color: var(--depression);
    }
    
    .history-item.mixte {
      border-left-color: var(--mixte);
    }
    
    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .history-phase {
      font-size: 16px;
      font-weight: bold;
      color: var(--text-dark);
    }
    
    .history-date {
      font-size: 12px;
      color: var(--text-light);
    }
    
    .history-intensity {
      font-size: 13px;
      color: var(--text-gray);
      margin-bottom: 5px;
    }
    
    .history-note {
      font-size: 13px;
      color: var(--text-gray);
      font-style: italic;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-light);
    }
    
    .empty-icon {
      font-size: 60px;
      margin-bottom: 15px;
    }
    
    .bottom-nav {
      position: fixed;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border-radius: var(--radius-lg);
      padding: 15px 25px;
      display: flex;
      gap: 35px;
      box-shadow: var(--shadow-md);
      z-index: 1000;
      max-width: 350px;
      width: calc(100% - 40px);
      justify-content: center;
    }
    
    .nav-item {
      font-size: 26px;
      cursor: pointer;
      transition: var(--transition);
      opacity: 0.4;
      text-decoration: none;
    }
    
    .nav-item.active {
      opacity: 1;
      transform: scale(1.15);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <a href="index.html" class="back-btn">‚Üê</a>
      <div class="header-title">Cycles Bipolaires</div>
      <div class="header-placeholder"></div>
    </div>
    
    <div class="card">
      <div class="card-title">Phase actuelle</div>
      
      <div class="phase-grid">
        <button class="phase-btn manie" onclick="cycleManager.selectPhase('manie')">
          üî• Manie
        </button>
        <button class="phase-btn hypomanie" onclick="cycleManager.selectPhase('hypomanie')">
          ‚ö° Hypomanie
        </button>
        <button class="phase-btn stable" onclick="cycleManager.selectPhase('stable')">
          ‚úÖ Stable
        </button>
        <button class="phase-btn depression" onclick="cycleManager.selectPhase('depression')">
          üíô D√©pression
        </button>
        <button class="phase-btn mixte" onclick="cycleManager.selectPhase('mixte')" style="grid-column: span 2;">
          üåÄ √âtat mixte
        </button>
      </div>
      
      <div class="intensity-group">
        <div class="intensity-label">Intensit√© de la phase</div>
        <input 
          type="range" 
          class="intensity-slider" 
          id="intensitySlider" 
          min="1" 
          max="10" 
          value="5"
          oninput="cycleManager.updateIntensity(this.value)"
        >
        <div class="intensity-value" id="intensityValue">5/10</div>
      </div>
      
      <textarea 
        class="note-textarea" 
        id="phaseNote"
        placeholder="Note sur cette phase (sympt√¥mes, d√©clencheurs...)"></textarea>
      
      <button class="save-btn" onclick="cycleManager.save()">üíö Enregistrer la phase</button>
    </div>
    
    <div class="card">
      <div class="card-title">Historique des phases</div>
      <ul class="history-list" id="historyList"></ul>
    </div>
  </div>
  
  <div class="bottom-nav">
    <a href="index.html" class="nav-item">üè†</a>
    <a href="mood.html" class="nav-item">üòä</a>
    <a href="journal.html" class="nav-item">üìù</a>
    <a href="traitement.html" class="nav-item">üíä</a>
    <a href="profil.html" class="nav-item">üë§</a>
  </div>
  
  <script>
    const STORAGE_KEY = 'mindflow_cycles';
    
    const cycleManager = {
      phases: [],
      selectedPhase: null,
      
      phaseLabels: {
        manie: 'Manie',
        hypomanie: 'Hypomanie',
        stable: 'Stable',
        depression: 'D√©pression',
        mixte: '√âtat mixte'
      },
      
      init() {
        this.loadData();
        this.render();
        this.checkToday();
      },
      
      loadData() {
        this.phases = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        this.phases.sort((a, b) => b.timestamp - a.timestamp);
      },
      
      saveData() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(this.phases));
      },
      
      checkToday() {
        const today = new Date().toISOString().split('T')[0];
        const todayPhase = this.phases.find(p => p.date === today);
        
        if (todayPhase) {
          this.selectPhase(todayPhase.phase);
          document.getElementById('intensitySlider').value = todayPhase.intensity;
          document.getElementById('intensityValue').textContent = `${todayPhase.intensity}/10`;
          document.getElementById('phaseNote').value = todayPhase.note || '';
        }
      },
      
      selectPhase(phase) {
        this.selectedPhase = phase;
        
        document.querySelectorAll('.phase-btn').forEach(btn => {
          btn.classList.remove('selected');
        });
        
        document.querySelector(`.phase-btn.${phase}`).classList.add('selected');
      },
      
      updateIntensity(value) {
        document.getElementById('intensityValue').textContent = `${value}/10`;
      },
      
      save() {
        if (!this.selectedPhase) {
          alert('Choisis d\'abord une phase ! üíö');
          return;
        }
        
        const today = new Date().toISOString().split('T')[0];
        const intensity = parseInt(document.getElementById('intensitySlider').value);
        const note = document.getElementById('phaseNote').value.trim();
        
        const existingIndex = this.phases.findIndex(p => p.date === today);
        
        const entry = {
          date: today,
          phase: this.selectedPhase,
          intensity,
          note,
          timestamp: Date.now()
        };
        
        if (existingIndex > -1) {
          this.phases[existingIndex] = entry;
        } else {
          this.phases.unshift(entry);
        }
        
        this.saveData();
        this.render();
        alert('‚úÖ Phase enregistr√©e ! üíö');
      },
      
      render() {
        const list = document.getElementById('historyList');
        
        if (this.phases.length === 0) {
          list.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">üîÑ</div>
              <div class="empty-text">Aucune phase enregistr√©e<br>Commence ton suivi !</div>
            </div>
          `;
          return;
        }
        
        list.innerHTML = this.phases.slice(0, 30).map(phase => {
          const date = new Date(phase.timestamp);
          
          return `
            <li class="history-item ${phase.phase}">
              <div class="history-header">
                <div class="history-phase">${this.phaseLabels[phase.phase]}</div>
                <div class="history-date">${date.toLocaleDateString('fr-FR')}</div>
              </div>
              <div class="history-intensity">Intensit√©: ${phase.intensity}/10</div>
              ${phase.note ? `<div class="history-note">${phase.note}</div>` : ''}
            </li>
          `;
        }).join('');
      }
    };
    
    document.addEventListener('DOMContentLoaded', () => {
      cycleManager.init();
    });
  </script>
</body>
</html>
