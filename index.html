<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>üíö MindFlow</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#8B7EB8">
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    :root {
      --primary: #8B7EB8;
      --primary-light: #B8A7D5;
      --secondary: #A8D8EA;
      --text-dark: #2D2D3A;
      --text-gray: #666;
      --bg-card: rgba(139, 126, 184, 0.05);
      --shadow-sm: 0 4px 20px rgba(0,0,0,0.08);
      --shadow-md: 0 8px 30px rgba(0,0,0,0.12);
      --radius-sm: 12px;
      --radius-md: 20px;
      --radius-lg: 25px;
      --gold: #FFD700;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      min-height: 100vh;
      padding: 15px;
      padding-bottom: 100px;
      overflow-x: hidden;
    }
    
    .container {
      max-width: 450px;
      margin: 0 auto;
    }
    
    /* ANIMATIONS DE BASE */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }
    
    /* Skeleton Loader */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 1000px 100%;
      animation: shimmer 2s infinite;
      border-radius: var(--radius-md);
    }
    
    .skeleton-header {
      height: 80px;
      margin-bottom: 20px;
    }
    
    .skeleton-card {
      height: 150px;
      margin-bottom: 20px;
    }
    
    /* Fade-in Cards */
    .fade-in {
      opacity: 0;
      animation: fadeInUp 0.6s ease forwards;
    }
    
    .fade-in:nth-child(1) { animation-delay: 0.1s; }
    .fade-in:nth-child(2) { animation-delay: 0.2s; }
    .fade-in:nth-child(3) { animation-delay: 0.3s; }
    .fade-in:nth-child(4) { animation-delay: 0.4s; }
    .fade-in:nth-child(5) { animation-delay: 0.5s; }
    .fade-in:nth-child(6) { animation-delay: 0.6s; }
    .fade-in:nth-child(7) { animation-delay: 0.7s; }
    .fade-in:nth-child(8) { animation-delay: 0.8s; }
    .fade-in:nth-child(9) { animation-delay: 0.9s; }
    
    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 25px;
      background: white;
      border-radius: var(--radius-md);
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
    }
    
    .header:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 24px;
      font-weight: bold;
      color: var(--primary);
      animation: slideInLeft 0.5s ease;
    }
    
    .pro-badge-header {
      background: linear-gradient(135deg, var(--gold) 0%, #FFA500 100%);
      color: white;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(255,215,0,0.3);
      transition: all 0.3s ease;
      display: none;
      position: relative;
      overflow: hidden;
    }
    
    .pro-badge-header.show {
      display: block;
      animation: bounce 0.5s ease;
    }
    
    /* Ripple Effect */
    .ripple {
      position: relative;
      overflow: hidden;
    }
    
    .ripple::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .ripple:active::after {
      width: 300px;
      height: 300px;
    }
    
    .upgrade-header {
      background: white;
      color: var(--gold);
      border: 2px solid var(--gold);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .upgrade-header:hover {
      background: var(--gold);
      color: white;
      transform: scale(1.05);
    }
    
    /* Crisis Button with pulse */
    .crisis-btn {
      display: block;
      text-decoration: none;
      margin-bottom: 20px;
    }
    
    .crisis-inner {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      border-radius: 25px;
      padding: 20px 25px;
      box-shadow: 0 8px 30px rgba(239,68,68,0.4);
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .crisis-inner::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: pulse 2s infinite;
    }
    
    .crisis-inner:active {
      transform: scale(0.98);
    }
    
    .crisis-left {
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 1;
    }
    
    .crisis-icon {
      font-size: 36px;
      animation: pulse 1.5s infinite;
    }
    
    .crisis-text-title {
      font-size: 20px;
      font-weight: bold;
      color: white;
      margin-bottom: 4px;
    }
    
    .crisis-text-subtitle {
      font-size: 13px;
      color: rgba(255,255,255,0.9);
    }
    
    .crisis-arrow {
      font-size: 28px;
      color: white;
      z-index: 1;
    }
    
    /* Welcome Card */
    .welcome-card {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      border-radius: var(--radius-lg);
      padding: 30px 25px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
      color: white;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .welcome-card::before {
      content: '‚ú®';
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 40px;
      opacity: 0.2;
      animation: bounce 3s infinite;
    }
    
    .welcome-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(139,126,184,0.3);
    }
    
    .greeting {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    
    .date-today {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 20px;
    }
    
    .quote {
      font-size: 15px;
      font-style: italic;
      opacity: 0.95;
      line-height: 1.6;
      padding: 15px;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
    }
    
    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      background: white;
      border-radius: var(--radius-sm);
      padding: 20px 15px;
      box-shadow: var(--shadow-sm);
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .stat-card:hover {
      transform: translateY(-8px) scale(1.05);
      box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    }
    
    .stat-icon {
      font-size: 32px;
      margin-bottom: 8px;
      display: inline-block;
      transition: all 0.3s ease;
    }
    
    .stat-card:hover .stat-icon {
      transform: rotate(360deg) scale(1.2);
    }
    
    .stat-number {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 4px;
    }
    
    .stat-label {
      font-size: 11px;
      color: var(--text-gray);
    }
    
    /* Cards */
    .card {
      background: white;
      border-radius: var(--radius-lg);
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
    }
    
    .card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-3px);
    }
    
    .card-title {
      font-size: 18px;
      font-weight: bold;
      color: var(--text-dark);
      margin-bottom: 20px;
    }
    
    /* Quick Actions */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    
    .action-btn {
      padding: 20px 15px;
      background: var(--bg-card);
      border: none;
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      text-decoration: none;
      color: var(--text-dark);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }
    
    .action-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(139, 126, 184, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.5s, height 0.5s;
    }
    
    .action-btn:hover::before {
      width: 300px;
      height: 300px;
    }
    
    .action-btn:hover {
      transform: scale(1.08);
      background: linear-gradient(135deg, var(--primary-light) 0%, var(--bg-card) 100%);
    }
    
    .action-icon {
      font-size: 32px;
      z-index: 1;
      transition: all 0.3s ease;
    }
    
    .action-btn:hover .action-icon {
      transform: scale(1.2) rotate(5deg);
    }
    
    /* Mood Quick */
    .mood-quick {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .mood-btn-quick {
      flex: 1;
      padding: 15px;
      background: var(--bg-card);
      border: 2px solid transparent;
      border-radius: var(--radius-sm);
      font-size: 28px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .mood-btn-quick:hover {
      transform: scale(1.15) rotate(-5deg);
      border-color: var(--primary);
    }
    
    .mood-btn-quick:active {
      transform: scale(0.95);
    }
    
    /* Chart */
    .mini-chart {
      height: 150px;
      margin-bottom: 15px;
    }
    
    .chart-link {
      display: block;
      text-align: center;
      color: var(--primary);
      text-decoration: none;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .chart-link:hover {
      transform: scale(1.05);
      color: var(--primary-light);
    }
    
    /* Journal Guid√© Card */
    .journal-guided-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: var(--radius-lg);
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
      color: white;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .journal-guided-card::before {
      content: '‚ú®';
      position: absolute;
      top: -10px;
      right: -10px;
      font-size: 80px;
      opacity: 0.15;
      animation: bounce 3s infinite;
    }
    
    .journal-guided-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
    }
    
    .journal-guided-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .journal-guided-prompt {
      font-size: 15px;
      opacity: 0.95;
      margin-bottom: 15px;
      font-style: italic;
      line-height: 1.5;
      padding: 15px;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
    }
    
    .journal-guided-btn {
      background: white;
      color: #667eea;
      padding: 12px 20px;
      border: none;
      border-radius: 15px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }
    
    .journal-guided-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    /* Insights Card */
    .insights-card {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      border-radius: var(--radius-lg);
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
      color: white;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .insights-card::before {
      content: 'üìä';
      position: absolute;
      top: -10px;
      right: -10px;
      font-size: 80px;
      opacity: 0.15;
      animation: pulse 3s infinite;
    }
    
    .insights-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(240, 147, 251, 0.4);
    }
    
    .insights-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .insight-item {
      background: rgba(255,255,255,0.15);
      padding: 12px 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      font-size: 14px;
      line-height: 1.5;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      transition: all 0.3s ease;
    }
    
    .insight-item:hover {
      background: rgba(255,255,255,0.25);
      transform: translateX(5px);
    }
    
    .insight-icon {
      font-size: 20px;
      flex-shrink: 0;
    }
    
    .no-insights {
      text-align: center;
      padding: 20px;
      opacity: 0.9;
      font-size: 14px;
    }
    
    /* PRO Teaser */
    .pro-teaser {
      background: linear-gradient(135deg, var(--gold) 0%, #FFA500 100%);
      border-radius: var(--radius-lg);
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(255,215,0,0.3);
      color: white;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .pro-teaser::before {
      content: '‚ú®';
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 60px;
      opacity: 0.2;
      animation: pulse 2s infinite;
    }
    
    .pro-teaser:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 50px rgba(255,215,0,0.5);
    }
    
    .pro-teaser-title {
      font-size: 22px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .pro-teaser-desc {
      font-size: 14px;
      opacity: 0.95;
      margin-bottom: 15px;
      line-height: 1.5;
    }
    
    .pro-features {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 15px;
      text-align: left;
    }
    
    .pro-feature {
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .try-pro-btn {
      background: white;
      color: var(--gold);
      padding: 12px 25px;
      border: none;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
    }
    
    .try-pro-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }
    
    /* Bottom Nav */
    .bottom-nav {
      position: fixed;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border-radius: var(--radius-lg);
      padding: 15px 25px;
      display: flex;
      gap: 35px;
      box-shadow: var(--shadow-md);
      z-index: 1000;
      max-width: 350px;
      width: calc(100% - 40px);
    }
    
    .nav-item {
      font-size: 26px;
      opacity: 0.4;
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .nav-item:hover {
      opacity: 0.7;
      transform: scale(1.2) translateY(-3px);
    }
    
    .nav-item.active {
      opacity: 1;
      transform: scale(1.15);
      animation: bounce 0.5s ease;
    }
    
    /* Loading overlay */
    .loading-overlay {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s ease;
    }
    
    .loading-overlay.hide {
      opacity: 0;
      pointer-events: none;
    }
    
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 5px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
  </div>
  
  <div class="container" id="mainContent" style="opacity: 0;">
    <!-- Header -->
    <div class="header fade-in">
      <div class="logo">üíö MindFlow</div>
      <div id="proBadgeHeader" class="pro-badge-header ripple">üíé PRO</div>
      <div id="upgradeHeader" class="upgrade-header ripple" onclick="dashboard.goToPro()">‚ú® Upgrade</div>
    </div>
    
    <!-- BOUTON MODE CRISE -->
    <a href="crise.html" class="crisis-btn fade-in">
      <div class="crisis-inner ripple">
        <div class="crisis-left">
          <div class="crisis-icon">üö®</div>
          <div>
            <div class="crisis-text-title">Mode Crise</div>
            <div class="crisis-text-subtitle">Besoin d'aide imm√©diate ?</div>
          </div>
        </div>
        <div class="crisis-arrow">‚Üí</div>
      </div>
    </a>
    
    <!-- Welcome Card -->
    <div class="welcome-card fade-in">
      <div class="greeting" id="greeting">Bienvenue !</div>
      <div class="date-today" id="dateToday"></div>
      <div class="quote" id="quote"></div>
    </div>
    
    <!-- Quick Stats -->
    <div class="stats-grid fade-in">
      <div class="stat-card">
        <div class="stat-icon">üî•</div>
        <div class="stat-number" id="streak">0</div>
        <div class="stat-label">Jours actifs</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üòä</div>
        <div class="stat-number" id="moodCount">0</div>
        <div class="stat-label">Humeurs</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üíä</div>
        <div class="stat-number" id="medRate">0%</div>
        <div class="stat-label">Observance</div>
      </div>
    </div>
    
    <!-- Quick Mood -->
    <div class="card fade-in">
      <div class="card-title">‚ö° Comment te sens-tu ?</div>
      <div class="mood-quick">
        <button class="mood-btn-quick ripple" onclick="dashboard.quickMood('üòä')">üòä</button>
        <button class="mood-btn-quick ripple" onclick="dashboard.quickMood('üòî')">üòî</button>
        <button class="mood-btn-quick ripple" onclick="dashboard.quickMood('üò∞')">üò∞</button>
        <button class="mood-btn-quick ripple" onclick="dashboard.quickMood('üò°')">üò°</button>
        <button class="mood-btn-quick ripple" onclick="dashboard.quickMood('üòå')">üòå</button>
      </div>
      <a href="mood.html" class="chart-link">
        Enregistrer une humeur d√©taill√©e ‚Üí
      </a>
    </div>
    
    <!-- Mini Chart -->
    <div class="card fade-in">
      <div class="card-title">üìä Cette semaine</div>
      <div class="mini-chart">
        <canvas id="weekChart"></canvas>
      </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="card fade-in">
      <div class="card-title">üöÄ Actions rapides</div>
      <div class="quick-actions">
        <a href="mood.html" class="action-btn ripple">
          <div class="action-icon">üòä</div>
          <div>Humeur</div>
        </a>
        <a href="journal.html" class="action-btn ripple">
          <div class="action-icon">üìù</div>
          <div>Journal</div>
        </a>
        <a href="traitement.html" class="action-btn ripple">
          <div class="action-icon">üíä</div>
          <div>M√©dicaments</div>
        </a>
        <a href="borderline.html" class="action-btn ripple">
          <div class="action-icon">üßò</div>
          <div>Comp√©tences</div>
        </a>
      </div>
    </div>
    
    <!-- Journal Guid√© Card -->
    <div class="journal-guided-card fade-in ripple" onclick="dashboard.openGuidedJournal()">
      <div class="journal-guided-title">üåô Journal Guid√©</div>
      <div class="journal-guided-prompt" id="journalPrompt">
        Chargement du prompt du jour...
      </div>
      <button class="journal-guided-btn">
        ‚úçÔ∏è √âcrire maintenant
      </button>
    </div>
    
    <!-- Insights & Patterns Card -->
    <div class="insights-card fade-in">
      <div class="insights-title">üìä Insights & Patterns</div>
      <div id="insightsContainer">
        <div class="no-insights">
          Continue d'utiliser MindFlow pour d√©couvrir des insights personnalis√©s sur tes patterns √©motionnels ! üìà
        </div>
      </div>
    </div>
    
    <!-- PRO Teaser -->
    <div class="pro-teaser fade-in ripple" onclick="dashboard.goToPro()" id="proTeaser">
      <div class="pro-teaser-title">‚ú® Passe √† MindFlow PRO</div>
      <div class="pro-teaser-desc">
        D√©bloque toutes les fonctionnalit√©s avanc√©es pour un suivi optimal
      </div>
      <div class="pro-features">
        <div class="pro-feature">‚úì √âmotions illimit√©es</div>
        <div class="pro-feature">‚úì Stats 30 jours</div>
        <div class="pro-feature">‚úì Insights avanc√©s</div>
        <div class="pro-feature">‚úì Export PDF</div>
        <div class="pro-feature">‚úì Th√®mes custom</div>
        <div class="pro-feature">‚úì Sans publicit√©s</div>
      </div>
      <button class="try-pro-btn">Essayer PRO gratuitement</button>
    </div>
  </div>
  
  <!-- Bottom Nav -->
  <div class="bottom-nav">
    <a href="index.html" class="nav-item active">üè†</a>
    <a href="mood.html" class="nav-item">üòä</a>
    <a href="journal.html" class="nav-item">üìù</a>
    <a href="traitement.html" class="nav-item">üíä</a>
    <a href="profil.html" class="nav-item">üë§</a>
  </div>
  
  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAtb4nTMjvlruh0fg5O9_wiAPJI1Nall-g",
      authDomain: "mindflow-66abc.firebaseapp.com",
      projectId: "mindflow-66abc",
      storageBucket: "mindflow-66abc.firebasestorage.app",
      messagingSenderId: "466651144452",
      appId: "1:466651144452:web:4b1dc68d4feac189683051",
      measurementId: "G-B7PEXP45WH"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }

    const auth = firebase.auth();
    const db = firebase.firestore();
    
    const quotes = [
      "Chaque jour est une nouvelle chance de progresser. üåü",
      "Tu es plus fort que tu ne le penses. üí™",
      "Prends soin de toi, tu le m√©rites. üíú",
      "Un pas √† la fois, tu avances. üö∂",
      "Tes √©motions sont valides. üé≠",
      "La gu√©rison n'est pas lin√©aire. üåà",
      "Tu n'es pas seul(e) dans ce voyage. ü§ù",
      "Respire. Tu g√®res √ßa. üå¨Ô∏è"
    ];
    
    // 100+ Journal Prompts
    const journalPrompts = [
      "Qu'est-ce qui t'a apport√© de la joie aujourd'hui, m√™me si c'√©tait quelque chose de petit ?",
      "D√©cris une situation difficile que tu as travers√©e r√©cemment. Comment t'es-tu senti(e) ?",
      "Quelles sont trois choses pour lesquelles tu es reconnaissant(e) en ce moment ?",
      "Quelle √©motion as-tu du mal √† accueillir ces derniers temps ? Pourquoi selon toi ?",
      "Si tu pouvais donner un conseil √† ton toi du pass√©, que dirais-tu ?",
      "Qu'est-ce qui te donne de l'√©nergie ? Qu'est-ce qui t'en enl√®ve ?",
      "D√©cris un moment o√π tu t'es senti(e) vraiment toi-m√™me.",
      "Quelles sont les pens√©es qui reviennent souvent dans ta t√™te ? Sont-elles aidantes ?",
      "Comment te sens-tu dans ton corps aujourd'hui ?",
      "Quelle peur aimerais-tu d√©passer ? Qu'est-ce qui te retient ?",
      "√âcris une lettre √† quelqu'un qui t'a bless√©(e), sans l'intention de l'envoyer.",
      "Qu'est-ce que tu aurais aim√© entendre aujourd'hui ?",
      "D√©cris ta journ√©e id√©ale, sans limites.",
      "Quelles limites as-tu besoin de poser dans ta vie en ce moment ?",
      "Comment as-tu pris soin de toi cette semaine ?",
      "Quelle partie de toi as-tu tendance √† cacher aux autres ?",
      "Si tes √©motions pouvaient parler, que te diraient-elles ?",
      "Qu'est-ce qui te fait te sentir en s√©curit√© ?",
      "Quels sont les signes que tu vas mieux ? Et ceux que tu vas moins bien ?",
      "√âcris sur un moment o√π tu as √©t√© fier(√®re) de toi.",
      "Quelles croyances sur toi-m√™me aimerais-tu changer ?",
      "Comment te traites-tu quand tu fais une erreur ?",
      "Qu'est-ce que tu attends des autres ? Est-ce r√©aliste ?",
      "D√©cris quelqu'un qui t'inspire. Qu'est-ce que tu admires chez cette personne ?",
      "Quelle habitude aimerais-tu d√©velopper ? Quel premier pas peux-tu faire ?",
      "Comment ton humeur a-t-elle √©volu√© cette semaine ?",
      "Qu'est-ce qui te fait sentir vivant(e) ?",
      "√âcris sur une conversation difficile que tu dois avoir.",
      "Quelles sont tes forces ? Comment peux-tu les utiliser davantage ?",
      "Qu'est-ce qui te manque dans ta vie actuellement ?",
      "D√©cris un endroit o√π tu te sens bien.",
      "Comment g√®res-tu le stress en ce moment ? Est-ce efficace ?",
      "Qu'est-ce que tu aimerais l√¢cher prise ?",
      "√âcris une liste de choses que tu aimes chez toi.",
      "Quelle relation dans ta vie m√©rite plus d'attention ?",
      "Comment ton enfant int√©rieur se sent-il aujourd'hui ?",
      "Qu'est-ce que tu repousses depuis longtemps ? Pourquoi ?",
      "D√©cris ta relation avec tes √©motions.",
      "Quels sont tes besoins non satisfaits en ce moment ?",
      "Comment te sens-tu par rapport √† ton avenir ?",
      "Qu'est-ce qui te fait te sentir coupable ? Est-ce justifi√© ?",
      "√âcris sur un changement que tu as r√©cemment v√©cu.",
      "Quelles sont tes valeurs les plus importantes ?",
      "Comment pourrais-tu √™tre plus gentil(le) avec toi-m√™me ?",
      "Qu'est-ce qui te stresse le plus actuellement ?",
      "D√©cris une victoire r√©cente, m√™me petite.",
      "Quels patterns remarques-tu dans tes relations ?",
      "Comment exprimes-tu ta col√®re ? Est-ce sain ?",
      "Qu'est-ce que tu aimerais dire √† quelqu'un mais que tu n'oses pas ?",
      "√âcris sur un r√™ve ou un objectif qui te tient √† c≈ìur.",
      "Comment te sens-tu quand tu es seul(e) ?",
      "Quelles sont les pens√©es automatiques qui surgissent dans les moments difficiles ?",
      "D√©cris ta routine matinale. Te sert-elle bien ?",
      "Qu'est-ce qui t'emp√™che d'√™tre pleinement toi-m√™me ?",
      "Comment c√©l√®bres-tu tes r√©ussites ?",
      "√âcris une lettre d'amour √† toi-m√™me.",
      "Qu'est-ce qui a chang√© en toi depuis un an ?",
      "Comment te sens-tu par rapport √† ton pass√© ?",
      "Quelles sont les choses que tu fais par obligation plut√¥t que par envie ?",
      "D√©cris ta relation avec le sommeil.",
      "Qu'est-ce qui te fait sentir compris(e) ?",
      "Comment g√®res-tu les critiques ?",
      "√âcris sur une personne qui te manque.",
      "Quelles sont tes peurs les plus profondes ?",
      "Comment ta sant√© mentale affecte-t-elle ta vie quotidienne ?",
      "Qu'est-ce que tu aimerais apprendre sur toi-m√™me ?",
      "D√©cris un moment o√π tu t'es senti(e) d√©pass√©(e). Comment as-tu fait face ?",
      "Quelles activit√©s te font oublier tes soucis ?",
      "Comment te sens-tu par rapport √† ton corps ?",
      "Qu'est-ce qui te donne de l'espoir ?",
      "√âcris sur une habitude toxique que tu aimerais changer.",
      "Comment tes √©motions influencent-elles tes d√©cisions ?",
      "Qu'est-ce que tu as appris sur toi r√©cemment ?",
      "D√©cris ta relation avec la nourriture.",
      "Comment pourrais-tu mieux √©couter tes besoins ?",
      "Qu'est-ce qui te fait te sentir incompris(e) ?",
      "√âcris sur un conflit int√©rieur que tu vis.",
      "Quelles sont les choses que tu fais pour fuir tes √©motions ?",
      "Comment te sens-tu dans tes relations actuelles ?",
      "Qu'est-ce que tu attends de la th√©rapie ou du soutien ?",
      "D√©cris un moment o√π tu as ressenti de la paix.",
      "Comment g√®res-tu l'incertitude ?",
      "Qu'est-ce qui te fait te sentir en vie ?",
      "√âcris sur une d√©ception r√©cente.",
      "Comment ta famille d'origine a-t-elle influenc√© qui tu es ?",
      "Quelles sont les phrases que tu te r√©p√®tes souvent ?",
      "D√©cris ta relation avec l'argent et le travail.",
      "Comment exprimes-tu ton amour aux autres ?",
      "Qu'est-ce qui te fait sentir vuln√©rable ?",
      "√âcris sur une blessure √©motionnelle qui cicatrise.",
      "Comment te sens-tu quand tu demandes de l'aide ?",
      "Quelles sont tes attentes envers toi-m√™me ? Sont-elles r√©alistes ?",
      "D√©cris un moment de connexion authentique avec quelqu'un.",
      "Comment g√®res-tu la solitude ?",
      "Qu'est-ce qui te donne du sens dans la vie ?",
      "√âcris sur une perte que tu as v√©cue.",
      "Comment ta sant√© mentale s'am√©liore-t-elle ?",
      "Quelles sont les choses que tu fais en pilote automatique ?",
      "D√©cris ta relation avec les r√©seaux sociaux.",
      "Comment te sens-tu par rapport aux changements ?",
      "Qu'est-ce qui te fait te sentir coinc√©(e) ?",
      "√âcris une liste de tes accomplissements cette ann√©e.",
      "Comment honores-tu tes limites ?",
      "Qu'est-ce que tu aimerais pardonner chez toi ou chez quelqu'un d'autre ?"
    ];
    
    const dashboard = {
      isPro: false,
      userName: 'ami',
      chart: null,
      
      async init() {
        await this.checkAuth();
        this.setGreeting();
        this.setDate();
        this.setQuote();
        this.setJournalPrompt();
        this.loadStats();
        this.generateInsights();
        this.initChart();
        this.hideLoading();
      },
      
      async checkAuth() {
        return new Promise((resolve) => {
          auth.onAuthStateChanged(async (user) => {
            if (!user) {
              window.location.href = 'login.html';
              return;
            }
            
            this.userName = user.displayName || user.email.split('@')[0];
            
            try {
              const userDoc = await db.collection('users').doc(user.uid).get();
              this.isPro = userDoc.exists && userDoc.data().isPro === true;
              this.updateProUI();
            } catch (error) {
              console.error('Erreur:', error);
            }
            
            resolve();
          });
        });
      },
      
      updateProUI() {
        if (this.isPro) {
          document.getElementById('proBadgeHeader').classList.add('show');
          document.getElementById('upgradeHeader').style.display = 'none';
          document.getElementById('proTeaser').style.display = 'none';
        } else {
          document.getElementById('upgradeHeader').style.display = 'block';
        }
      },
      
      setGreeting() {
        const hour = new Date().getHours();
        let greeting = 'Bonjour';
        
        if (hour < 12) greeting = 'Bonjour';
        else if (hour < 18) greeting = 'Bon apr√®s-midi';
        else greeting = 'Bonsoir';
        
        document.getElementById('greeting').textContent = `${greeting}, ${this.userName} !`;
      },
      
      setDate() {
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const today = new Date().toLocaleDateString('fr-FR', options);
        document.getElementById('dateToday').textContent = today.charAt(0).toUpperCase() + today.slice(1);
      },
      
      setQuote() {
        const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
        document.getElementById('quote').textContent = randomQuote;
      },
      
      setJournalPrompt() {
        // Get day of year to have consistent daily prompt
        const now = new Date();
        const start = new Date(now.getFullYear(), 0, 0);
        const diff = now - start;
        const oneDay = 1000 * 60 * 60 * 24;
        const dayOfYear = Math.floor(diff / oneDay);
        
        const promptIndex = dayOfYear % journalPrompts.length;
        const prompt = journalPrompts[promptIndex];
        
        document.getElementById('journalPrompt').textContent = `"${prompt}"`;
      },
      
      loadStats() {
        // Streak
        const moods = JSON.parse(localStorage.getItem('mindflow_moods_v2') || '[]');
        const uniqueDays = new Set(moods.map(m => m.date)).size;
        document.getElementById('streak').textContent = uniqueDays;
        
        // Mood count
        document.getElementById('moodCount').textContent = moods.length;
        
        // Med rate
        const history = JSON.parse(localStorage.getItem('mindflow_meds_history_v2') || '{}');
        const taken = Object.values(history).filter(h => h.status === 'taken').length;
        const total = Object.keys(history).length;
        const rate = total > 0 ? Math.round((taken / total) * 100) : 0;
        document.getElementById('medRate').textContent = rate + '%';
      },
      
      generateInsights() {
        const moods = JSON.parse(localStorage.getItem('mindflow_moods_v2') || '[]');
        
        if (moods.length < 5) {
          return; // Not enough data
        }
        
        const insights = [];
        
        // Analyze day of week patterns
        const dayPatterns = {};
        moods.forEach(mood => {
          const date = new Date(mood.date);
          const day = date.toLocaleDateString('fr-FR', { weekday: 'long' });
          
          if (!dayPatterns[day]) {
            dayPatterns[day] = [];
          }
          dayPatterns[day].push(mood.intensity);
        });
        
        // Find best and worst days
        let bestDay = null;
        let worstDay = null;
        let bestAvg = 0;
        let worstAvg = 10;
        
        Object.keys(dayPatterns).forEach(day => {
          const avg = dayPatterns[day].reduce((a, b) => a + b, 0) / dayPatterns[day].length;
          if (avg > bestAvg) {
            bestAvg = avg;
            bestDay = day;
          }
          if (avg < worstAvg) {
            worstAvg = avg;
            worstDay = day;
          }
        });
        
        if (bestDay && Math.abs(bestAvg - worstAvg) > 1.5) {
          insights.push({
            icon: 'üìÖ',
            text: `Tu te sens g√©n√©ralement mieux les ${bestDay}s (intensit√© moyenne: ${bestAvg.toFixed(1)}/10)`
          });
          
          if (worstDay) {
            insights.push({
              icon: '‚ö†Ô∏è',
              text: `Attention aux ${worstDay}s - c'est souvent plus difficile pour toi`
            });
          }
        }
        
        // Analyze recent trend
        const recentMoods = moods.slice(-7);
        if (recentMoods.length >= 7) {
          const recentAvg = recentMoods.reduce((acc, m) => acc + m.intensity, 0) / recentMoods.length;
          const olderMoods = moods.slice(-14, -7);
          if (olderMoods.length >= 7) {
            const olderAvg = olderMoods.reduce((acc, m) => acc + m.intensity, 0) / olderMoods.length;
            
            if (recentAvg > olderAvg + 1) {
              insights.push({
                icon: 'üìà',
                text: `Tendance positive ! Ton humeur s'am√©liore ces derniers jours`
              });
            } else if (recentAvg < olderAvg - 1) {
              insights.push({
                icon: 'üíô',
                text: `Tu sembles traverser une p√©riode plus difficile. Prends soin de toi`
              });
            }
          }
        }
        
        // Check medication adherence impact
        const history = JSON.parse(localStorage.getItem('mindflow_meds_history_v2') || '{}');
        if (Object.keys(history).length > 0) {
          const adherenceRate = Object.values(history).filter(h => h.status === 'taken').length / Object.keys(history).length;
          
          if (adherenceRate > 0.8) {
            insights.push({
              icon: 'üíä',
              text: `Excellent suivi de ton traitement (${Math.round(adherenceRate * 100)}%) ! Continue comme √ßa`
            });
          } else if (adherenceRate < 0.5) {
            insights.push({
              icon: '‚è∞',
              text: `Pense √† prendre tes m√©dicaments plus r√©guli√®rement - √ßa peut aider`
            });
          }
        }
        
        // Display insights
        const container = document.getElementById('insightsContainer');
        if (insights.length > 0) {
          container.innerHTML = insights.map(insight => `
            <div class="insight-item">
              <div class="insight-icon">${insight.icon}</div>
              <div>${insight.text}</div>
            </div>
          `).join('');
        }
      },
      
      initChart() {
        const ctx = document.getElementById('weekChart').getContext('2d');
        const moods = JSON.parse(localStorage.getItem('mindflow_moods_v2') || '[]');
        
        const labels = [];
        const data = [];
        
        for (let i = 6; i >= 0; i--) {
          const date = new Date();
          date.setDate(date.getDate() - i);
          const dateStr = date.toISOString().split('T')[0];
          
          labels.push(date.toLocaleDateString('fr-FR', { weekday: 'short' }));
          
          const mood = moods.find(m => m.date === dateStr);
          data.push(mood ? mood.intensity : null);
        }
        
        this.chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels,
            datasets: [{
              label: 'Intensit√©',
              data,
              borderColor: '#8B7EB8',
              backgroundColor: 'rgba(139, 126, 184, 0.1)',
              tension: 0.4,
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, max: 10 } }
          }
        });
      },
      
      quickMood(emoji) {
        if (confirm(`Enregistrer ${emoji} comme humeur du moment ?`)) {
          const moods = JSON.parse(localStorage.getItem('mindflow_moods_v2') || '[]');
          const today = new Date().toISOString().split('T')[0];
          
          const emojiMap = { 'üòä': 0, 'üòî': 1, 'üò∞': 2, 'üò°': 3, 'üòå': 4 };
          
          moods.push({
            date: today,
            emotions: [emojiMap[emoji]],
            triggers: [],
            intensity: 5,
            energy: 3,
            sleep: 7,
            note: 'Enregistrement rapide',
            timestamp: Date.now()
          });
          
          localStorage.setItem('mindflow_moods_v2', JSON.stringify(moods));
          
          // Animation success
          const btn = event.target;
          btn.style.transform = 'scale(1.3)';
          setTimeout(() => {
            btn.style.transform = 'scale(1)';
            alert('‚úÖ Humeur enregistr√©e !');
            this.loadStats();
            this.generateInsights();
            this.initChart();
          }, 300);
        }
      },
      
      openGuidedJournal() {
        const prompt = document.getElementById('journalPrompt').textContent.replace(/"/g, '');
        localStorage.setItem('mindflow_journal_prompt', prompt);
        window.location.href = 'journal.html';
      },
      
      goToPro() {
        window.location.href = 'subscription.html';
      },
      
      hideLoading() {
        setTimeout(() => {
          document.getElementById('loadingOverlay').classList.add('hide');
          document.getElementById('mainContent').style.opacity = '1';
          document.getElementById('mainContent').style.transition = 'opacity 0.5s ease';
        }, 800);
      }
    };
    
    document.addEventListener('DOMContentLoaded', () => {
      dashboard.init();
    });
  </script>
</body>
</html>
