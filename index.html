<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üö® MindFlow - Mode Crise</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ef4444">
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    :root {
      --danger: #ef4444;
      --danger-dark: #dc2626;
      --warning: #f59e0b;
      --success: #10b981;
      --text-dark: #2D2D3A;
      --text-gray: #666;
      --bg-card: rgba(239, 68, 68, 0.05);
      --shadow-sm: 0 4px 20px rgba(0,0,0,0.08);
      --shadow-md: 0 8px 30px rgba(0,0,0,0.12);
      --radius-sm: 12px;
      --radius-md: 20px;
      --radius-lg: 25px;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, var(--danger) 0%, #f87171 100%);
      min-height: 100vh;
      padding: 15px;
      padding-bottom: 100px;
    }
    
    .container {
      max-width: 450px;
      margin: 0 auto;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 25px;
      background: white;
      border-radius: var(--radius-md);
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
    }
    
    .back-btn {
      font-size: 24px;
      text-decoration: none;
      color: var(--text-dark);
    }
    
    .header-title {
      font-size: 20px;
      font-weight: bold;
      color: var(--danger);
    }
    
    /* Alert Banner */
    .alert-banner {
      background: white;
      border-radius: var(--radius-lg);
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
      text-align: center;
      border: 3px solid var(--danger);
    }
    
    .alert-icon {
      font-size: 60px;
      margin-bottom: 15px;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    .alert-title {
      font-size: 24px;
      font-weight: bold;
      color: var(--danger);
      margin-bottom: 10px;
    }
    
    .alert-subtitle {
      font-size: 15px;
      color: var(--text-gray);
      line-height: 1.6;
    }
    
    /* Emergency Buttons */
    .emergency-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .emergency-btn {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      background: white;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      color: var(--text-dark);
      box-shadow: var(--shadow-sm);
    }
    
    .emergency-btn.red {
      background: var(--danger);
      color: white;
      border: 3px solid var(--danger-dark);
    }
    
    .emergency-btn:active {
      transform: scale(0.98);
    }
    
    .btn-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .btn-icon {
      font-size: 32px;
    }
    
    .btn-text {
      text-align: left;
    }
    
    .btn-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 3px;
    }
    
    .btn-subtitle {
      font-size: 12px;
      opacity: 0.8;
    }
    
    .btn-arrow {
      font-size: 24px;
    }
    
    /* Card */
    .card {
      background: white;
      border-radius: var(--radius-lg);
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
    }
    
    .card-title {
      font-size: 18px;
      font-weight: bold;
      color: var(--text-dark);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    /* Grounding Exercises */
    .exercise-item {
      background: var(--bg-card);
      padding: 20px;
      border-radius: var(--radius-sm);
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .exercise-item:active {
      transform: scale(0.98);
    }
    
    .exercise-title {
      font-size: 16px;
      font-weight: bold;
      color: var(--danger);
      margin-bottom: 8px;
    }
    
    .exercise-desc {
      font-size: 14px;
      color: var(--text-gray);
      line-height: 1.5;
    }
    
    /* Breathing Timer */
    .breathing-container {
      text-align: center;
      padding: 30px;
    }
    
    .breathing-circle {
      width: 200px;
      height: 200px;
      margin: 0 auto 30px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--danger) 0%, #f87171 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: bold;
      color: white;
      transition: all 4s ease;
    }
    
    .breathing-circle.inhale {
      transform: scale(1.3);
    }
    
    .breathing-circle.exhale {
      transform: scale(0.8);
    }
    
    .breathing-instruction {
      font-size: 20px;
      font-weight: bold;
      color: var(--danger);
      margin-bottom: 20px;
    }
    
    .breathing-btn {
      padding: 15px 30px;
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }
    
    /* Contacts */
    .contact-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px;
      background: var(--bg-card);
      border-radius: var(--radius-sm);
      margin-bottom: 12px;
    }
    
    .contact-info {
      flex: 1;
    }
    
    .contact-name {
      font-size: 16px;
      font-weight: bold;
      color: var(--text-dark);
      margin-bottom: 4px;
    }
    
    .contact-phone {
      font-size: 14px;
      color: var(--text-gray);
    }
    
    .call-btn {
      padding: 10px 20px;
      background: var(--success);
      color: white;
      border: none;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
    }
    
    .add-contact-btn {
      width: 100%;
      padding: 15px;
      background: var(--bg-card);
      border: 2px dashed var(--danger);
      border-radius: var(--radius-sm);
      font-size: 15px;
      font-weight: 600;
      color: var(--danger);
      cursor: pointer;
      margin-top: 10px;
    }
    
    /* Safety Plan */
    .plan-step {
      margin-bottom: 20px;
    }
    
    .step-number {
      display: inline-block;
      width: 30px;
      height: 30px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 30px;
      font-weight: bold;
      margin-right: 10px;
    }
    
    .step-title {
      font-size: 16px;
      font-weight: bold;
      color: var(--text-dark);
      margin-bottom: 8px;
    }
    
    .step-input {
      width: 100%;
      padding: 12px;
      border: 2px solid #E5E5E5;
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-family: inherit;
      resize: vertical;
      min-height: 80px;
      outline: none;
    }
    
    .step-input:focus {
      border-color: var(--danger);
    }
    
    .save-plan-btn {
      width: 100%;
      padding: 16px;
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 15px;
      font-size: 17px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 20px;
    }
    
    .bottom-nav {
      position: fixed;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border-radius: var(--radius-lg);
      padding: 15px 25px;
      display: flex;
      gap: 35px;
      box-shadow: var(--shadow-md);
      z-index: 1000;
      max-width: 350px;
      width: calc(100% - 40px);
    }
    
    .nav-item {
      font-size: 26px;
      opacity: 0.4;
      text-decoration: none;
    }
    
    .nav-item.active {
      opacity: 1;
      transform: scale(1.15);
    }
    
    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }
    
    .modal.show {
      display: flex;
    }
    
    .modal-content {
      background: white;
      border-radius: var(--radius-lg);
      padding: 30px;
      max-width: 400px;
      width: 100%;
    }
    
    .modal-close {
      text-align: right;
      font-size: 28px;
      cursor: pointer;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <a href="index.html" class="back-btn">‚Üê</a>
      <div class="header-title">Mode Crise</div>
      <div style="width: 24px;"></div>
    </div>
    
    <!-- Alert Banner -->
    <div class="alert-banner">
      <div class="alert-icon">üö®</div>
      <div class="alert-title">Tu n'es pas seul(e)</div>
      <div class="alert-subtitle">
        Si tu es en d√©tresse, appelle les num√©ros d'urgence ci-dessous. Ils sont l√† pour t'aider 24h/24.
      </div>
    </div>
    
    <!-- Emergency Numbers -->
    <div class="emergency-grid">
      <a href="tel:3114" class="emergency-btn red">
        <div class="btn-left">
          <div class="btn-icon">üìû</div>
          <div class="btn-text">
            <div class="btn-title">3114</div>
            <div class="btn-subtitle">Num√©ro national de pr√©vention du suicide</div>
          </div>
        </div>
        <div class="btn-arrow">‚Üí</div>
      </a>
      
      <a href="tel:15" class="emergency-btn red">
        <div class="btn-left">
          <div class="btn-icon">üöë</div>
          <div class="btn-text">
            <div class="btn-title">15 - SAMU</div>
            <div class="btn-subtitle">Urgence m√©dicale</div>
          </div>
        </div>
        <div class="btn-arrow">‚Üí</div>
      </a>
      
      <a href="tel:0140093900" class="emergency-btn">
        <div class="btn-left">
          <div class="btn-icon">üí¨</div>
          <div class="btn-text">
            <div class="btn-title">01 40 09 39 00</div>
            <div class="btn-subtitle">SOS Amiti√© - √âcoute 24h/24</div>
          </div>
        </div>
        <div class="btn-arrow">‚Üí</div>
      </a>
      
      <a href="tel:0800235236" class="emergency-btn">
        <div class="btn-left">
          <div class="btn-icon">üéß</div>
          <div class="btn-text">
            <div class="btn-title">0800 23 52 36</div>
            <div class="btn-subtitle">Fil Sant√© Jeunes (12-25 ans)</div>
          </div>
        </div>
        <div class="btn-arrow">‚Üí</div>
      </a>
    </div>
    
    <!-- Breathing Exercise -->
    <div class="card">
      <div class="card-title">ü´Å Exercice de respiration</div>
      <div class="breathing-container">
        <div class="breathing-circle" id="breathingCircle">Respire</div>
        <div class="breathing-instruction" id="breathingText">Pr√™t √† commencer ?</div>
        <button class="breathing-btn" onclick="criseManager.toggleBreathing()" id="breathingBtn">
          D√©marrer
        </button>
      </div>
    </div>
    
    <!-- Grounding Exercises -->
    <div class="card">
      <div class="card-title">üßò Exercices de grounding</div>
      
      <div class="exercise-item" onclick="criseManager.showExercise('54321')">
        <div class="exercise-title">Technique 5-4-3-2-1</div>
        <div class="exercise-desc">
          Reconnecte-toi au moment pr√©sent en utilisant tes 5 sens
        </div>
      </div>
      
      <div class="exercise-item" onclick="criseManager.showExercise('ice')">
        <div class="exercise-title">Glace sur le visage</div>
        <div class="exercise-desc">
          Plonge ton visage dans l'eau froide ou tiens un gla√ßon
        </div>
      </div>
      
      <div class="exercise-item" onclick="criseManager.showExercise('muscle')">
        <div class="exercise-title">Relaxation musculaire</div>
        <div class="exercise-desc">
          Contracte et rel√¢che chaque groupe musculaire
        </div>
      </div>
      
      <div class="exercise-item" onclick="criseManager.showExercise('walk')">
        <div class="exercise-title">Marche consciente</div>
        <div class="exercise-desc">
          Concentre-toi sur chaque pas et chaque sensation
        </div>
      </div>
    </div>
    
    <!-- My Contacts -->
    <div class="card">
      <div class="card-title">üë• Mes contacts de confiance</div>
      <div id="contactsList"></div>
      <button class="add-contact-btn" onclick="criseManager.addContact()">
        ‚ûï Ajouter un contact
      </button>
    </div>
    
    <!-- Safety Plan -->
    <div class="card">
      <div class="card-title">üìã Mon plan de s√©curit√©</div>
      
      <div class="plan-step">
        <div class="step-title">
          <span class="step-number">1</span>
          Mes signes d'alerte
        </div>
        <textarea class="step-input" id="warning-signs" placeholder="Ex: Pens√©es n√©gatives r√©currentes, isolement social..."></textarea>
      </div>
      
      <div class="plan-step">
        <div class="step-title">
          <span class="step-number">2</span>
          Strat√©gies d'adaptation
        </div>
        <textarea class="step-input" id="coping-strategies" placeholder="Ex: √âcouter de la musique, appeler un ami, faire du sport..."></textarea>
      </div>
      
      <div class="plan-step">
        <div class="step-title">
          <span class="step-number">3</span>
          Lieux s√©curisants
        </div>
        <textarea class="step-input" id="safe-places" placeholder="Ex: Biblioth√®que, caf√© pr√©f√©r√©, parc..."></textarea>
      </div>
      
      <div class="plan-step">
        <div class="step-title">
          <span class="step-number">4</span>
          Raisons de vivre
        </div>
        <textarea class="step-input" id="reasons-to-live" placeholder="Ex: Ma famille, mes amis, mes projets futurs..."></textarea>
      </div>
      
      <button class="save-plan-btn" onclick="criseManager.savePlan()">
        üíæ Sauvegarder mon plan
      </button>
    </div>
  </div>
  
  <div class="bottom-nav">
    <a href="index.html" class="nav-item">üè†</a>
    <a href="mood.html" class="nav-item">üòä</a>
    <a href="journal.html" class="nav-item">üìù</a>
    <a href="traitement.html" class="nav-item">üíä</a>
    <a href="profil.html" class="nav-item">üë§</a>
  </div>
  
  <!-- Exercise Modal -->
  <div class="modal" id="exerciseModal">
    <div class="modal-content">
      <div class="modal-close" onclick="criseManager.closeModal()">√ó</div>
      <div id="exerciseContent"></div>
    </div>
  </div>
  
  <script>
    const CONTACTS_KEY = 'mindflow_crisis_contacts';
    const PLAN_KEY = 'mindflow_safety_plan';
    
    const exercises = {
      '54321': `
        <h2 style="color: var(--danger); margin-bottom: 15px;">üßò Technique 5-4-3-2-1</h2>
        <p style="margin-bottom: 15px; line-height: 1.6;">Nomme √† voix haute ou dans ta t√™te :</p>
        <ul style="line-height: 2; margin-left: 20px; margin-bottom: 15px;">
          <li><strong>5 choses</strong> que tu vois</li>
          <li><strong>4 choses</strong> que tu touches</li>
          <li><strong>3 choses</strong> que tu entends</li>
          <li><strong>2 choses</strong> que tu sens (odeurs)</li>
          <li><strong>1 chose</strong> que tu go√ªtes</li>
        </ul>
        <p style="color: var(--text-gray);">Prends ton temps avec chaque sens. Cela t'aide √† revenir au moment pr√©sent.</p>
      `,
      'ice': `
        <h2 style="color: var(--danger); margin-bottom: 15px;">‚ùÑÔ∏è Glace sur le visage</h2>
        <p style="margin-bottom: 15px; line-height: 1.6;">Cette technique active ton r√©flexe de plong√©e :</p>
        <ol style="line-height: 2; margin-left: 20px; margin-bottom: 15px;">
          <li>Remplis un bol d'eau froide avec des gla√ßons</li>
          <li>Retiens ta respiration</li>
          <li>Plonge ton visage pendant 30 secondes</li>
          <li>Ou tiens un gla√ßon contre ton front/joues</li>
        </ol>
        <p style="color: var(--text-gray);">Le froid ralentit ton rythme cardiaque et calme l'anxi√©t√© intense.</p>
      `,
      'muscle': `
        <h2 style="color: var(--danger); margin-bottom: 15px;">üí™ Relaxation musculaire</h2>
        <p style="margin-bottom: 15px; line-height: 1.6;">Contracte puis rel√¢che chaque groupe musculaire :</p>
        <ol style="line-height: 2; margin-left: 20px; margin-bottom: 15px;">
          <li>Pieds (5 secondes contract√©, 10 rel√¢ch√©)</li>
          <li>Jambes</li>
          <li>Abdomen</li>
          <li>Mains et bras</li>
          <li>√âpaules</li>
          <li>Visage</li>
        </ol>
        <p style="color: var(--text-gray);">Cette tension-d√©tente aide ton corps √† rel√¢cher le stress.</p>
      `,
      'walk': `
        <h2 style="color: var(--danger); margin-bottom: 15px;">üö∂ Marche consciente</h2>
        <p style="margin-bottom: 15px; line-height: 1.6;">Marche lentement en te concentrant sur :</p>
        <ul style="line-height: 2; margin-left: 20px; margin-bottom: 15px;">
          <li>Le contact de tes pieds avec le sol</li>
          <li>Le mouvement de tes jambes</li>
          <li>Ta respiration naturelle</li>
          <li>Les sensations dans ton corps</li>
          <li>Les sons autour de toi</li>
        </ul>
        <p style="color: var(--text-gray);">M√™me 5 minutes de marche consciente peuvent t'apaiser.</p>
      `
    };
    
    const criseManager = {
      breathingActive: false,
      breathingInterval: null,
      contacts: [],
      
      init() {
        this.loadContacts();
        this.loadPlan();
        this.renderContacts();
      },
      
      loadContacts() {
        this.contacts = JSON.parse(localStorage.getItem(CONTACTS_KEY) || '[]');
      },
      
      saveContacts() {
        localStorage.setItem(CONTACTS_KEY, JSON.stringify(this.contacts));
      },
      
      renderContacts() {
        const container = document.getElementById('contactsList');
        
        if (this.contacts.length === 0) {
          container.innerHTML = '<p style="text-align: center; color: var(--text-gray); padding: 20px;">Aucun contact ajout√©</p>';
          return;
        }
        
        container.innerHTML = this.contacts.map((c, i) => `
          <div class="contact-item">
            <div class="contact-info">
              <div class="contact-name">${c.name}</div>
              <div class="contact-phone">${c.phone}</div>
            </div>
            <a href="tel:${c.phone}" class="call-btn">üìû Appeler</a>
          </div>
        `).join('');
      },
      
      addContact() {
        const name = prompt('Nom du contact :');
        if (!name) return;
        
        const phone = prompt('Num√©ro de t√©l√©phone :');
        if (!phone) return;
        
        this.contacts.push({ name, phone });
        this.saveContacts();
        this.renderContacts();
      },
      
      loadPlan() {
        const plan = JSON.parse(localStorage.getItem(PLAN_KEY) || '{}');
        
        if (plan.warningSigns) document.getElementById('warning-signs').value = plan.warningSigns;
        if (plan.copingStrategies) document.getElementById('coping-strategies').value = plan.copingStrategies;
        if (plan.safePlaces) document.getElementById('safe-places').value = plan.safePlaces;
        if (plan.reasonsToLive) document.getElementById('reasons-to-live').value = plan.reasonsToLive;
      },
      
      savePlan() {
        const plan = {
          warningSigns: document.getElementById('warning-signs').value,
          copingStrategies: document.getElementById('coping-strategies').value,
          safePlaces: document.getElementById('safe-places').value,
          reasonsToLive: document.getElementById('reasons-to-live').value
        };
        
        localStorage.setItem(PLAN_KEY, JSON.stringify(plan));
        alert('‚úÖ Plan de s√©curit√© sauvegard√© !');
      },
      
      toggleBreathing() {
        if (this.breathingActive) {
          this.stopBreathing();
        } else {
          this.startBreathing();
        }
      },
      
      startBreathing() {
        this.breathingActive = true;
        document.getElementById('breathingBtn').textContent = 'Arr√™ter';
        
        let phase = 0; // 0 = inhale, 1 = hold, 2 = exhale, 3 = hold
        const circle = document.getElementById('breathingCircle');
        const text = document.getElementById('breathingText');
        
        const cycle = () => {
          switch(phase) {
            case 0:
              text.textContent = 'Inspire profond√©ment...';
              circle.classList.remove('exhale');
              circle.classList.add('inhale');
              break;
            case 1:
              text.textContent = 'Retiens...';
              break;
            case 2:
              text.textContent = 'Expire lentement...';
              circle.classList.remove('inhale');
              circle.classList.add('exhale');
              break;
            case 3:
              text.textContent = 'Retiens...';
              break;
          }
          
          phase = (phase + 1) % 4;
        };
        
        cycle();
        this.breathingInterval = setInterval(cycle, 4000);
      },
      
      stopBreathing() {
        this.breathingActive = false;
        clearInterval(this.breathingInterval);
        document.getElementById('breathingBtn').textContent = 'D√©marrer';
        document.getElementById('breathingText').textContent = 'Pr√™t √† recommencer ?';
        document.getElementById('breathingCircle').classList.remove('inhale', 'exhale');
      },
      
      showExercise(type) {
        document.getElementById('exerciseContent').innerHTML = exercises[type];
        document.getElementById('exerciseModal').classList.add('show');
      },
      
      closeModal() {
        document.getElementById('exerciseModal').classList.remove('show');
      }
    };
    
    document.addEventListener('DOMContentLoaded', () => {
      criseManager.init();
    });
  </script>
</body>
</html>
