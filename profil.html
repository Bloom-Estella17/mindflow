// REMPLACE la fonction toggleAccordion par CECI :

toggleAccordion(id) {
  const header = event.currentTarget;
  const content = document.getElementById(`content-${id}`);
  
  // Check PRO status before opening a NEW diagnostic
  const isPro = this.checkProStatus();
  
  // If trying to open (not close) and not PRO
  if (!isPro && !header.classList.contains('active')) {
    const filledCount = this.countFilledDiagnostics();
    
    // Check if this diagnostic is already filled
    const isThisDiagFilled = this.isDiagnosticFilled(id);
    
    // If already have 2 filled and trying to open a 3rd unfilled one
    if (filledCount >= 2 && !isThisDiagFilled) {
      if (confirm('ðŸ”’ Version gratuite : 2 diagnostics maximum.\n\nðŸ’Ž Passe Ã  PRO pour dÃ©bloquer tous les diagnostics et profiter d\'un suivi complet !\n\nVoir les options PRO ?')) {
        window.location.href = 'subscription.html';
      }
      return;
    }
  }
  
  if (this.currentAccordion && this.currentAccordion !== id) {
    const prevHeader = document.querySelector(`#content-${this.currentAccordion}`).previousElementSibling;
    const prevContent = document.getElementById(`content-${this.currentAccordion}`);
    prevHeader.classList.remove('active');
    prevContent.classList.remove('show');
  }
  
  header.classList.toggle('active');
  content.classList.toggle('show');
  
  this.currentAccordion = header.classList.contains('active') ? id : null;
},

// AJOUTE CES 3 NOUVELLES FONCTIONS APRÃˆS toggleAccordion :

checkProStatus() {
  // Check if in preview mode
  const previewMode = localStorage.getItem('previewFreeMode') === 'true';
  if (previewMode) return false;
  
  // Check real PRO status
  const localPro = localStorage.getItem('mindflow_is_pro');
  return localPro === 'true';
},

isDiagnosticFilled(diagId) {
  const saved = localStorage.getItem(ANSWERS_KEY);
  if (!saved) return false;
  
  const answers = JSON.parse(saved);
  const fields = Object.keys(answers).filter(key => key.startsWith(diagId + '-'));
  return fields.some(field => answers[field] && answers[field].trim().length > 0);
},

countFilledDiagnostics() {
  const saved = localStorage.getItem(ANSWERS_KEY);
  if (!saved) return 0;
  
  const answers = JSON.parse(saved);
  const diagnostics = ['borderline', 'tag', 'bipolaire', 'tdi', 'schizophrenie', 'depression', 'tspt', 'toc', 'tca', 'tdah'];
  
  let filledCount = 0;
  diagnostics.forEach(diag => {
    const fields = Object.keys(answers).filter(key => key.startsWith(diag + '-'));
    const hasFilled = fields.some(field => answers[field] && answers[field].trim().length > 0);
    if (hasFilled) filledCount++;
  });
  
  return filledCount;
},
