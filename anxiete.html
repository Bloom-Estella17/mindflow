<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>üò∞ MindFlow - Anxi√©t√©</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#8B7EB8">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    :root {
      --primary: #8B7EB8;
      --primary-light: #B8A7D5;
      --secondary: #A8D8EA;
      --text-dark: #2D2D3A;
      --text-gray: #666;
      --text-light: #888;
      --bg-card: rgba(139, 126, 184, 0.05);
      --shadow-sm: 0 4px 20px rgba(0,0,0,0.08);
      --shadow-md: 0 8px 30px rgba(0,0,0,0.12);
      --radius-sm: 12px;
      --radius-md: 20px;
      --radius-lg: 25px;
      --transition: all 0.3s ease;
      --anxiety: #ef4444;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      min-height: 100vh;
      padding: 15px;
      padding-bottom: 100px;
    }
    
    .container {
      max-width: 450px;
      margin: 0 auto;
      width: 100%;
      padding: 0 5px;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 25px;
      background: white;
      border-radius: var(--radius-md);
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
    }
    
    .back-btn {
      font-size: 24px;
      cursor: pointer;
      text-decoration: none;
      transition: var(--transition);
    }
    
    .header-title {
      font-size: 20px;
      font-weight: bold;
      color: var(--primary);
    }
    
    .add-btn {
      font-size: 28px;
      cursor: pointer;
      color: var(--primary);
      transition: var(--transition);
    }
    
    .emergency-card {
      background: linear-gradient(135deg, #ef4444 0%, #fca5a5 100%);
      border-radius: var(--radius-lg);
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(239, 68, 68, 0.3);
      color: white;
    }
    
    .emergency-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 15px;
    }
    
    .breathing-guide {
      background: rgba(255,255,255,0.2);
      padding: 20px;
      border-radius: var(--radius-sm);
      text-align: center;
    }
    
    .breathing-text {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .breathing-instruction {
      font-size: 14px;
      opacity: 0.9;
    }
    
    .card {
      background: white;
      border-radius: var(--radius-lg);
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
    }
    
    .card-title {
      font-size: 20px;
      font-weight: bold;
      color: var(--text-dark);
      margin-bottom: 20px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-item {
      background: var(--bg-card);
      padding: 20px;
      border-radius: var(--radius-sm);
      text-align: center;
    }
    
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      color: var(--anxiety);
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 13px;
      color: var(--text-gray);
    }
    
    .crisis-list {
      list-style: none;
    }
    
    .crisis-item {
      background: var(--bg-card);
      padding: 18px;
      border-radius: var(--radius-sm);
      margin-bottom: 12px;
      border-left: 4px solid var(--anxiety);
    }
    
    .crisis-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }
    
    .crisis-date {
      font-size: 14px;
      font-weight: 600;
      color: var(--anxiety);
    }
    
    .crisis-duration {
      font-size: 13px;
      color: var(--text-gray);
    }
    
    .crisis-intensity {
      font-size: 13px;
      color: var(--text-gray);
      margin-bottom: 8px;
    }
    
    .crisis-triggers {
      font-size: 13px;
      color: var(--text-gray);
      font-style: italic;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-light);
    }
    
    .empty-icon {
      font-size: 60px;
      margin-bottom: 15px;
    }
    
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      display: none;
    }
    
    .modal-overlay.show {
      display: block;
    }
    
    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: var(--radius-lg);
      padding: 30px;
      max-width: 90%;
      width: 400px;
      max-height: 80vh;
      overflow-y: auto;
      z-index: 2001;
      display: none;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .modal.show {
      display: block;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .modal-title {
      font-size: 22px;
      font-weight: bold;
      color: var(--text-dark);
    }
    
    .modal-close {
      font-size: 28px;
      cursor: pointer;
      color: var(--text-light);
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 8px;
      display: block;
    }
    
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #E5E5E5;
      border-radius: var(--radius-sm);
      font-size: 15px;
      font-family: inherit;
      outline: none;
      transition: var(--transition);
    }
    
    .form-input:focus, .form-select:focus, .form-textarea:focus {
      border-color: var(--primary);
    }
    
    .form-textarea {
      resize: vertical;
      min-height: 80px;
    }
    
    .intensity-slider {
      width: 100%;
      height: 8px;
      -webkit-appearance: none;
      appearance: none;
      background: #E5E5E5;
      border-radius: 5px;
      outline: none;
      margin-bottom: 8px;
    }
    
    .intensity-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      background: var(--anxiety);
      border-radius: 50%;
      cursor: pointer;
    }
    
    .intensity-value {
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      color: var(--anxiety);
    }
    
    .save-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      border: none;
      border-radius: 15px;
      font-size: 17px;
      font-weight: bold;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .save-btn:active {
      transform: scale(0.98);
    }
    
    .bottom-nav {
      position: fixed;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border-radius: var(--radius-lg);
      padding: 15px 25px;
      display: flex;
      gap: 35px;
      box-shadow: var(--shadow-md);
      z-index: 1000;
      max-width: 350px;
      width: calc(100% - 40px);
      justify-content: center;
    }
    
    .nav-item {
      font-size: 26px;
      cursor: pointer;
      transition: var(--transition);
      opacity: 0.4;
      text-decoration: none;
    }
    
    .nav-item.active {
      opacity: 1;
      transform: scale(1.15);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <a href="index.html" class="back-btn">‚Üê</a>
      <div class="header-title">Anxi√©t√© / Crises</div>
      <div class="add-btn" onclick="anxietyManager.openModal()">+</div>
    </div>
    
    <div class="emergency-card">
      <div class="emergency-title">ü´Å Respiration guid√©e</div>
      <div class="breathing-guide">
        <div class="breathing-text" id="breathingText">Inspire...</div>
        <div class="breathing-instruction">Suis le rythme pour calmer l'anxi√©t√©</div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">Statistiques</div>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value" id="totalCrises">0</div>
          <div class="stat-label">Crises totales</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="monthCrises">0</div>
          <div class="stat-label">Ce mois-ci</div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">Historique des crises</div>
      <ul class="crisis-list" id="crisisList"></ul>
    </div>
  </div>
  
  <div class="bottom-nav">
    <a href="index.html" class="nav-item">üè†</a>
    <a href="mood.html" class="nav-item">üòä</a>
    <a href="journal.html" class="nav-item">üìù</a>
    <a href="traitement.html" class="nav-item">üíä</a>
    <a href="profil.html" class="nav-item">üë§</a>
  </div>
  
  <div class="modal-overlay" id="modalOverlay" onclick="anxietyManager.closeModal()"></div>
  <div class="modal" id="crisisModal">
    <div class="modal-header">
      <div class="modal-title">Enregistrer une crise</div>
      <div class="modal-close" onclick="anxietyManager.closeModal()">√ó</div>
    </div>
    
    <div class="form-group">
      <label class="form-label">Dur√©e (minutes)</label>
      <input type="number" class="form-input" id="crisisDuration" placeholder="Ex: 15" min="1">
    </div>
    
    <div class="form-group">
      <label class="form-label">Intensit√©</label>
      <input 
        type="range" 
        class="intensity-slider" 
        id="intensitySlider" 
        min="1" 
        max="10" 
        value="5"
        oninput="anxietyManager.updateIntensity(this.value)"
      >
      <div class="intensity-value" id="intensityValue">5/10</div>
    </div>
    
    <div class="form-group">
      <label class="form-label">D√©clencheurs identifi√©s</label>
      <textarea 
        class="form-textarea" 
        id="crisisTriggers"
        placeholder="Qu'est-ce qui a d√©clench√© la crise ?"></textarea>
    </div>
    
    <div class="form-group">
      <label class="form-label">Ce qui m'a aid√©</label>
      <textarea 
        class="form-textarea" 
        id="crisisHelp"
        placeholder="Qu'est-ce qui t'a aid√© √† te calmer ?"></textarea>
    </div>
    
    <button class="save-btn" onclick="anxietyManager.save()">üíö Enregistrer</button>
  </div>
  
  <script>
    const STORAGE_KEY = 'mindflow_anxiety';
    
    const anxietyManager = {
      crises: [],
      breathingInterval: null,
      
      init() {
        this.loadData();
        this.render();
        this.updateStats();
        this.startBreathing();
      },
      
      loadData() {
        this.crises = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        this.crises.sort((a, b) => b.timestamp - a.timestamp);
      },
      
      saveData() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(this.crises));
      },
      
      startBreathing() {
        const text = document.getElementById('breathingText');
        let phase = 0;
        const phases = [
          { text: 'Inspire...', duration: 4000 },
          { text: 'Retiens...', duration: 4000 },
          { text: 'Expire...', duration: 6000 },
          { text: 'Pause...', duration: 2000 }
        ];
        
        const cycle = () => {
          text.textContent = phases[phase].text;
          setTimeout(() => {
            phase = (phase + 1) % phases.length;
            cycle();
          }, phases[phase].duration);
        };
        
        cycle();
      },
      
      render() {
        const list = document.getElementById('crisisList');
        
        if (this.crises.length === 0) {
          list.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">üò∞</div>
              <div class="empty-text">Aucune crise enregistr√©e</div>
            </div>
          `;
          return;
        }
        
        list.innerHTML = this.crises.slice(0, 20).map(crisis => {
          const date = new Date(crisis.timestamp);
          
          return `
            <li class="crisis-item">
              <div class="crisis-header">
                <div class="crisis-date">${date.toLocaleDateString('fr-FR')} - ${date.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}</div>
                <div class="crisis-duration">${crisis.duration} min</div>
              </div>
              <div class="crisis-intensity">Intensit√©: ${crisis.intensity}/10</div>
              ${crisis.triggers ? `<div class="crisis-triggers">D√©clencheurs: ${crisis.triggers}</div>` : ''}
              ${crisis.help ? `<div class="crisis-triggers">Aide: ${crisis.help}</div>` : ''}
            </li>
          `;
        }).join('');
      },
      
      updateStats() {
        const total = this.crises.length;
        document.getElementById('totalCrises').textContent = total;
        
        const now = new Date();
        const thisMonth = this.crises.filter(crisis => {
          const crisisDate = new Date(crisis.timestamp);
          return crisisDate.getMonth() === now.getMonth() && 
                 crisisDate.getFullYear() === now.getFullYear();
        }).length;
        
        document.getElementById('monthCrises').textContent = thisMonth;
      },
      
      updateIntensity(value) {
        document.getElementById('intensityValue').textContent = `${value}/10`;
      },
      
      openModal() {
        document.getElementById('crisisDuration').value = '';
        document.getElementById('intensitySlider').value = 5;
        document.getElementById('intensityValue').textContent = '5/10';
        document.getElementById('crisisTriggers').value = '';
        document.getElementById('crisisHelp').value = '';
        
        document.getElementById('modalOverlay').classList.add('show');
        document.getElementById('crisisModal').classList.add('show');
      },
      
      closeModal() {
        document.getElementById('modalOverlay').classList.remove('show');
        document.getElementById('crisisModal').classList.remove('show');
      },
      
      save() {
        const duration = parseInt(document.getElementById('crisisDuration').value);
        const intensity = parseInt(document.getElementById('intensitySlider').value);
        const triggers = document.getElementById('crisisTriggers').value.trim();
        const help = document.getElementById('crisisHelp').value.trim();
        
        if (!duration) {
          alert('Indique au moins la dur√©e ! üíö');
          return;
        }
        
        this.crises.unshift({
          id: Date.now(),
          timestamp: Date.now(),
          duration,
          intensity,
          triggers,
          help
        });
        
        this.saveData();
        this.closeModal();
        this.render();
        this.updateStats();
      }
    };
    
    document.addEventListener('DOMContentLoaded', () => {
      anxietyManager.init();
    });
  </script>
</body>
</html>
