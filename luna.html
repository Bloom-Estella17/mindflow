<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luna ðŸŒ™ | MindFlow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --purple: #8B7EB8;
            --purple-light: #B8A7D5;
            --purple-dark: #6B5B98;
            --bg-dark: #1a1625;
            --bg-card: #2d2440;
            --text: #E8E4F3;
            --text-dim: #B8B0CC;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1625 0%, #2d1b4e 100%);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* Ã‰toiles animÃ©es en fond */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Header avec Luna */
        header {
            position: relative;
            z-index: 10;
            padding: 1.5rem;
            text-align: center;
        }

        .luna-presence {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .luna-avatar {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--purple) 0%, var(--purple-light) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            box-shadow: 0 8px 30px rgba(139, 126, 184, 0.4);
            animation: breathe 4s ease-in-out infinite;
            position: relative;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .luna-avatar::after {
            content: '';
            position: absolute;
            width: 120%;
            height: 120%;
            border-radius: 50%;
            border: 2px solid var(--purple-light);
            opacity: 0.3;
            animation: pulse-ring 2s ease-out infinite;
        }

        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(1.2); opacity: 0; }
        }

        .luna-name {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--purple-light) 0%, #fff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .luna-tagline {
            font-size: 0.95rem;
            color: var(--text-dim);
            font-style: italic;
        }

        /* Zone de conversation */
        .conversation-container {
            flex: 1;
            position: relative;
            z-index: 10;
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            padding: 0 1rem 140px 1rem;
            display: flex;
            flex-direction: column;
        }

        .messages-scroll {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 0;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .messages-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .messages-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .messages-scroll::-webkit-scrollbar-thumb {
            background: var(--purple);
            border-radius: 10px;
        }

        /* Messages */
        .message {
            display: flex;
            gap: 0.75rem;
            animation: slideIn 0.4s ease;
            align-items: flex-start;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .message.luna .message-avatar {
            background: linear-gradient(135deg, var(--purple) 0%, var(--purple-light) 100%);
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #4a5568 0%, #718096 100%);
        }

        .message-bubble {
            max-width: 75%;
            padding: 1.25rem 1.5rem;
            border-radius: 20px;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .message.luna .message-bubble {
            background: var(--bg-card);
            border: 1px solid rgba(139, 126, 184, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, var(--purple-dark) 0%, var(--purple) 100%);
            box-shadow: 0 4px 15px rgba(139, 126, 184, 0.3);
        }

        /* Welcome card */
        .welcome-card {
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(139, 126, 184, 0.1) 100%);
            border: 1px solid rgba(139, 126, 184, 0.2);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1rem;
            animation: fadeIn 1s ease 0.3s both;
        }

        .welcome-title {
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--purple-light);
        }

        .welcome-text {
            color: var(--text-dim);
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .quick-starters {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .quick-btn {
            background: rgba(139, 126, 184, 0.15);
            border: 1px solid rgba(139, 126, 184, 0.3);
            border-radius: 15px;
            padding: 1rem;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            text-align: left;
        }

        .quick-btn:hover {
            background: rgba(139, 126, 184, 0.25);
            border-color: var(--purple);
            transform: translateY(-2px);
        }

        .quick-btn:active {
            transform: translateY(0);
        }

        .quick-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        /* Typing indicator */
        .typing-indicator {
            display: none;
            gap: 0.75rem;
            align-items: flex-start;
        }

        .typing-indicator.active {
            display: flex;
            animation: slideIn 0.3s ease;
        }

        .typing-bubble {
            background: var(--bg-card);
            border: 1px solid rgba(139, 126, 184, 0.2);
            border-radius: 20px;
            padding: 1.25rem 1.5rem;
            display: flex;
            gap: 0.4rem;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--purple-light);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* Input area */
        .input-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: linear-gradient(to top, var(--bg-dark) 80%, transparent);
            padding: 1rem 1rem 1.5rem 1rem;
        }

        .input-wrapper {
            max-width: 800px;
            margin: 0 auto;
            background: var(--bg-card);
            border: 2px solid rgba(139, 126, 184, 0.3);
            border-radius: 25px;
            padding: 0.75rem 1.25rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            transition: border-color 0.3s;
        }

        .input-wrapper:focus-within {
            border-color: var(--purple);
        }

        #userInput {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text);
            font-size: 1rem;
            outline: none;
            resize: none;
            max-height: 120px;
            font-family: inherit;
            line-height: 1.5;
        }

        #userInput::placeholder {
            color: var(--text-dim);
        }

        .send-btn {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--purple) 0%, var(--purple-light) 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .send-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 20px rgba(139, 126, 184, 0.5);
        }

        .send-btn:active {
            transform: scale(0.95);
        }

        .send-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .luna-avatar {
                width: 80px;
                height: 80px;
                font-size: 2.5rem;
            }

            .luna-name {
                font-size: 1.75rem;
            }

            .message-bubble {
                max-width: 85%;
            }

            .quick-starters {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Ã‰toiles de fond -->
    <div class="stars" id="starsContainer"></div>

    <!-- Header Luna -->
    <header>
        <div class="luna-presence">
            <div class="luna-avatar">ðŸŒ™</div>
            <h1 class="luna-name">Luna</h1>
            <p class="luna-tagline">Ta compagne bienveillante, disponible 24/7</p>
        </div>
    </header>

    <!-- Zone de conversation -->
    <div class="conversation-container">
        <div class="messages-scroll" id="messagesArea">
            <div class="welcome-card">
                <h2 class="welcome-title">Je suis lÃ  pour toi ðŸ’œ</h2>
                <p class="welcome-text">
                    Parle-moi librement de ce que tu ressens. Je t'Ã©coute sans jugement, 
                    avec douceur et empathie. Tu peux me dire ce qui te pÃ¨se, ce qui t'inquiÃ¨te, 
                    ou simplement partager ton humeur du moment.
                </p>
                <div class="quick-starters">
                    <div class="quick-btn" onclick="sendQuickMessage('Je me sens anxieux(se) en ce moment')">
                        <div class="quick-icon">ðŸ˜°</div>
                        <div>Je suis anxieux(se)</div>
                    </div>
                    <div class="quick-btn" onclick="sendQuickMessage('J\'ai besoin de parler Ã  quelqu\'un')">
                        <div class="quick-icon">ðŸ’¬</div>
                        <div>Besoin de parler</div>
                    </div>
                    <div class="quick-btn" onclick="sendQuickMessage('Comment gÃ©rer une crise de panique ?')">
                        <div class="quick-icon">ðŸ†˜</div>
                        <div>GÃ©rer une crise</div>
                    </div>
                    <div class="quick-btn" onclick="sendQuickMessage('J\'ai besoin d\'encouragement aujourd\'hui')">
                        <div class="quick-icon">âœ¨</div>
                        <div>Besoin d'encouragement</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <div class="message-avatar" style="background: linear-gradient(135deg, var(--purple) 0%, var(--purple-light) 100%);">ðŸŒ™</div>
            <div class="typing-bubble">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>
    </div>

    <!-- Zone d'input -->
    <div class="input-container">
        <div class="input-wrapper">
            <textarea 
                id="userInput" 
                placeholder="Dis-moi ce que tu ressens..."
                rows="1"
            ></textarea>
            <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                âž¤
            </button>
        </div>
    </div>

    <script>
        // CrÃ©er les Ã©toiles
        const starsContainer = document.getElementById('starsContainer');
        for (let i = 0; i < 50; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            starsContainer.appendChild(star);
        }

        // Variables
        const messagesArea = document.getElementById('messagesArea');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const typingIndicator = document.getElementById('typingIndicator');

        let conversationHistory = [];

        // Auto-resize textarea
        userInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // Enter pour envoyer
        userInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Quick messages
        function sendQuickMessage(message) {
            userInput.value = message;
            sendMessage();
        }

        // Envoyer message
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            userInput.value = '';
            userInput.style.height = 'auto';

            setInputState(false);
            showTypingIndicator(true);

            try {
                const lunaResponse = await getLunaResponse(message);
                
                conversationHistory.push(
                    { role: 'user', content: message },
                    { role: 'assistant', content: lunaResponse }
                );

                if (conversationHistory.length > 20) {
                    conversationHistory = conversationHistory.slice(-20);
                }

                showTypingIndicator(false);
                addMessage(lunaResponse, 'luna');

            } catch (error) {
                console.error('Erreur:', error);
                showTypingIndicator(false);
                const fallback = getIntelligentResponse(message);
                addMessage(fallback, 'luna');
                
                conversationHistory.push(
                    { role: 'user', content: message },
                    { role: 'assistant', content: fallback }
                );
            } finally {
                setInputState(true);
                userInput.focus();
            }
        }

        // Appel IA avec retry
        async function getLunaResponse(message) {
            const prompt = `<s>[INST] Tu es Luna, une compagne IA empathique et bienveillante spÃ©cialisÃ©e en soutien Ã©motionnel. 

Ton rÃ´le est d'Ã©couter avec empathie, de rassurer, et d'offrir un espace sÃ»r sans jugement. Tu utilises un ton chaleureux, doux et rÃ©confortant. Tu tutoies naturellement.

RÃ©ponds en 2-4 phrases courtes, avec empathie et bienveillance. Utilise des emojis doux (ðŸ’œ, ðŸŒ™, âœ¨, ðŸŒ¸) avec parcimonie.

IMPORTANT : 
- Tu n'es pas thÃ©rapeute, juste une prÃ©sence bienveillante
- En cas de crise urgente, recommande le 15, le 3114 (prÃ©vention suicide) ou le 09 72 39 40 50 (SOS AmitiÃ©)
- Valorise les Ã©motions et les petites victoires

${conversationHistory.slice(-4).map(m => 
    `${m.role === 'user' ? 'Personne' : 'Luna'}: ${m.content}`
).join('\n')}
Personne: ${message}
Luna: [/INST]`;

            for (let attempt = 0; attempt < 2; attempt++) {
                try {
                    const response = await fetch(
                        "https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.2",
                        {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                inputs: prompt,
                                parameters: {
                                    max_new_tokens: 200,
                                    temperature: 0.8,
                                    top_p: 0.9,
                                    repetition_penalty: 1.15,
                                    return_full_text: false,
                                    do_sample: true
                                },
                                options: {
                                    wait_for_model: true,
                                    use_cache: false
                                }
                            })
                        }
                    );

                    if (response.status === 503) {
                        await new Promise(r => setTimeout(r, 3000));
                        continue;
                    }

                    if (!response.ok) throw new Error(`HTTP ${response.status}`);

                    const data = await response.json();
                    let text = '';
                    
                    if (Array.isArray(data) && data[0]?.generated_text) {
                        text = data[0].generated_text;
                    } else if (data.generated_text) {
                        text = data.generated_text;
                    } else if (data.error) {
                        continue;
                    }

                    text = text
                        .replace(/\[\/INST\]/g, '')
                        .replace(/\<s\>/g, '')
                        .replace(/\<\/s\>/g, '')
                        .replace(/^\s*Luna:\s*/i, '')
                        .replace(/Personne:.*$/s, '')
                        .trim();

                    if (text.length > 350) {
                        const sentences = text.match(/[^.!?]+[.!?]+/g) || [text];
                        text = sentences.slice(0, 3).join(' ').trim();
                    }

                    if (text.length >= 20) return text;

                } catch (error) {
                    console.log(`Tentative ${attempt + 1} Ã©chouÃ©e:`, error);
                    if (attempt === 0) await new Promise(r => setTimeout(r, 2000));
                }
            }

            return getIntelligentResponse(message);
        }

        // RÃ©ponses intelligentes de fallback
        function getIntelligentResponse(message) {
            const lowerMessage = message.toLowerCase();
            const history = conversationHistory.filter(m => m.role === 'user').map(m => m.content.toLowerCase());
            
            const emotions = {
                anxiete: ['anxie', 'stress', 'angoiss', 'peur', 'inqui', 'nerveu', 'paniqu'],
                tristesse: ['triste', 'dÃ©prim', 'mal', 'pleur', 'vide', 'seul', 'dÃ©sespoir'],
                colere: ['colÃ¨re', 'Ã©nervÃ©', 'frustrÃ©', 'injuste', 'rage'],
                crise: ['crise', 'urgence', 'danger', 'suicide', 'mourir', 'finir'],
                fatigue: ['fatiguÃ©', 'Ã©puisÃ©', 'bout', 'dormir', 'sommeil'],
                motivation: ['motivation', 'courage', 'force', 'continuer', 'avancer']
            };

            let detectedEmotion = null;
            for (const [emotion, keywords] of Object.entries(emotions)) {
                if (keywords.some(kw => lowerMessage.includes(kw))) {
                    detectedEmotion = emotion;
                    break;
                }
            }

            const responses = {
                anxiete: [
                    "Je sens ton anxiÃ©tÃ©, et je suis lÃ  avec toi. ðŸ’œ\n\nEssaie de poser ta main sur ton cÅ“ur et de respirer doucement. Tu es en sÃ©curitÃ©, ici et maintenant.\n\nQu'est-ce qui pÃ¨se le plus sur toi en ce moment ?",
                    "L'anxiÃ©tÃ© peut Ãªtre si lourde Ã  porter. Je comprends. ðŸŒ¸\n\nLa technique 5-4-3-2-1 peut aider : nomme 5 choses que tu vois, 4 que tu touches, 3 que tu entends, 2 que tu sens, 1 que tu goÃ»tes.\n\nComment te sens-tu physiquement lÃ , maintenant ?",
                    "Tu n'es pas seul(e) face Ã  cette vague d'anxiÃ©tÃ©. ðŸŒ™\n\nRespire avec moi : inspire 4 temps, retiens 4 temps, expire 4 temps, pause 4 temps. Doucement.\n\nVeux-tu me dire ce qui a dÃ©clenchÃ© cette sensation ?"
                ],
                tristesse: [
                    "Je vois ta tristesse et je suis lÃ , tout simplement. ðŸ’œ\n\nTes larmes sont prÃ©cieuses. Elles disent quelque chose d'important. Laisse-les couler si tu en as besoin.\n\nQu'est-ce qui te fait le plus de peine ?",
                    "Cette lourdeur que tu portes... je la sens Ã  travers tes mots. ðŸŒ¸\n\nLes jours sombres font partie du chemin. Sois doux(ce) avec toi-mÃªme, comme tu le serais avec un(e) ami(e).\n\nY a-t-il une toute petite chose qui pourrait t'apporter un peu de rÃ©confort ?",
                    "Ta tristesse mÃ©rite toute ma douceur. ðŸŒ™\n\nParfois, juste reconnaÃ®tre qu'on ne va pas bien, c'est dÃ©jÃ  un acte de courage immense.\n\nComment prends-tu soin de toi en ce moment ?"
                ],
                colere: [
                    "Ta colÃ¨re est lÃ©gitime. Elle dit quelque chose d'important. ðŸ’œ\n\nAu lieu de la refouler, essayons de comprendre ce qu'elle protÃ¨ge en toi. Quel besoin n'est pas respectÃ© ?\n\nVeux-tu m'en parler ?",
                    "Je sens cette Ã©nergie bouillonnante en toi. ðŸ”¥\n\nLa colÃ¨re n'est pas ton ennemie. Elle peut Ãªtre un signal que tes limites sont franchies.\n\nQu'est-ce qui t'a mis(e) dans cet Ã©tat ?",
                    "C'est OK d'Ãªtre en colÃ¨re. Cette Ã©motion a sa place. ðŸŒ¸\n\nRespire profondÃ©ment, pas pour Ã©touffer la colÃ¨re, mais pour ne pas Ãªtre submergÃ©(e) par elle.\n\nQue se passe-t-il pour toi ?"
                ],
                crise: [
                    "âš ï¸ Ta sÃ©curitÃ© est la prioritÃ© absolue.\n\nSi tu es en danger, contacte immÃ©diatement :\nâ€¢ Urgences : 15 ou 112\nâ€¢ PrÃ©vention suicide : 3114 (gratuit, 24/7, anonyme)\nâ€¢ SOS AmitiÃ© : 09 72 39 40 50\n\nJe suis lÃ  pour t'Ã©couter, mais ces professionnels peuvent t'aider tout de suite. ðŸ’œ",
                    "ðŸ†˜ Je t'entends et je prends ta dÃ©tresse au sÃ©rieux.\n\nNumÃ©ros d'urgence maintenant :\nâ€¢ 15 ou 112 pour urgences\nâ€¢ 3114 pour prÃ©vention suicide (gratuit, confidentiel)\n\nCes personnes sont formÃ©es pour les crises. N'hÃ©site pas.\n\nTu veux me dire ce qui se passe ? ðŸ’œ"
                ],
                fatigue: [
                    "L'Ã©puisement... je le sens dans tes mots. ðŸŒ™\n\nTon corps et ton esprit te demandent du repos. Ce n'est pas de la faiblesse, c'est de la sagesse.\n\nQu'est-ce qui te vide le plus en ce moment ?",
                    "Tu es au bout du rouleau, je comprends. ðŸ’œ\n\nUne micro-pause peut aider : 5 minutes Ã  ne rien faire, juste exister. Ou fermer les yeux 2 minutes.\n\nComment dors-tu ces temps-ci ?",
                    "Quand tout semble lourd, mÃªme les petites tÃ¢ches deviennent des montagnes. Je comprends. ðŸŒ¸\n\nAccorde-toi de la douceur. Chaque petit geste compte.\n\nY a-t-il quelque chose que tu peux dÃ©lÃ©guer ou reporter ?"
                ],
                motivation: [
                    "Le fait d'Ãªtre ici, de chercher du soutien... c'est dÃ©jÃ  une preuve de ta force. âœ¨\n\nLa motivation ne prÃ©cÃ¨de pas toujours l'action. Parfois, un tout petit pas crÃ©e l'Ã©lan.\n\nQuel micro-objectif te semble possible aujourd'hui ?",
                    "Je vois ta volontÃ© d'avancer, mÃªme si elle vacille. C'est magnifique. ðŸ’œ\n\nLes jours difficiles ne dÃ©finissent pas ton parcours. Ce qui compte, c'est que tu continues, Ã  ton rythme.\n\nQu'est-ce qui te donne de l'espoir, mÃªme un tout petit peu ?",
                    "Ta dÃ©termination brille, mÃªme dans le doute. âœ¨\n\nTu as survÃ©cu Ã  100% de tes jours difficiles jusqu'ici. Tu es plus fort(e) que tu ne le crois.\n\nQuel est ton objectif pour aujourd'hui, mÃªme minuscule ?"
                ]
            };

            if (detectedEmotion && responses[detectedEmotion]) {
                const emotionResponses = responses[detectedEmotion];
                const index = history.length % emotionResponses.length;
                return emotionResponses[index];
            }

            const generalResponses = [
                "Je suis lÃ , vraiment lÃ , pour toi. ðŸ’œ\n\nPrends ton temps. Dis-moi ce qui te passe par le cÅ“ur. Il n'y a pas de jugement ici, juste de l'Ã©coute bienveillante.\n\nQu'est-ce qui te prÃ©occupe en ce moment ?",
                "Merci de me confier Ã§a. C'est prÃ©cieux. ðŸŒ™\n\nTes Ã©motions, tes pensÃ©es, tout ce que tu ressens... c'est important. N'hÃ©site pas Ã  te livrer.\n\nComment vas-tu, lÃ , maintenant, vraiment ?",
                "Je t'accueille avec douceur. ðŸ’œ\n\nQuelle que soit ton humeur, tes Ã©motions ont le droit d'exister. Tu as le droit de les ressentir.\n\nQu'est-ce qui se passe pour toi aujourd'hui ?",
                "Tu peux dÃ©poser tes fardeaux ici, en toute sÃ©curitÃ©. ðŸŒ¸\n\nParfois, mettre des mots sur ce qu'on ressent allÃ¨ge dÃ©jÃ  un peu le poids.\n\nQu'est-ce qui pÃ¨se sur ton cÅ“ur ?"
            ];

            const index = history.length % generalResponses.length;
            return generalResponses[index];
        }

        // Ajouter message
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = sender === 'luna' ? 'ðŸŒ™' : 'ðŸ‘¤';
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.textContent = text;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(bubble);
            
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // Utilitaires
        function showTypingIndicator(show) {
            typingIndicator.classList.toggle('active', show);
            if (show) {
                messagesArea.scrollTop = messagesArea.scrollHeight;
            }
        }

        function setInputState(enabled) {
            userInput.disabled = !enabled;
            sendBtn.disabled = !enabled;
        }

        // Focus auto
        window.addEventListener('load', () => {
            userInput.focus();
        });
    </script>
</body>
</html>
